import { useState, useEffect, useMemo } from 'react';
import Papa from 'papaparse';
import Highcharts from 'highcharts';
import HighchartsReact from 'highcharts-react-official';
import { Search, X, Sun, Moon, TrendingUp, Users, Award, Activity, Trophy, Target, Calendar, Medal, Star, Zap, Menu } from 'lucide-react';

// íƒ€ì… ì •ì˜
interface AthleteResult {
  ì¢…ëª©: string;
  ì„±ë³„: string;
  ì„ ìˆ˜ëª…: string;
  ìƒë…„: string;
  ì—°ë ¹ëŒ€: string;
  ì†Œì†: string;
  ì‹œì¦Œ: string;
  ëŒ€íšŒëª…: string;
  ëŒ€íšŒì¹´í…Œê³ ë¦¬: string;
  ë‚ ì§œ: string;
  ë­í‚¹: number | string;
  í¬ì¸íŠ¸: number | string;
  FISí”„ë¡œí•„URL: string;
}

const CATEGORY_ORDER = { 'OG': 1, 'WCH': 2, 'WC': 3, 'EC': 4, 'FIS': 5, '': 999 };
const CATEGORY_LABELS: Record<string, string> = {
  'OG': 'ì˜¬ë¦¼í”½',
  'WCH': 'ì„¸ê³„ì„ ìˆ˜ê¶Œ',
  'WC': 'ì›”ë“œì»µ',
  'EC': 'ìœ ëŸ½ì»µ',
  'FIS': 'FISì»µ'
};

const CURRENT_SEASON = '2025/26';
const SEASON_START = '2025-07-01';
const SEASON_END = '2026-06-30';

function App() {
  const [darkMode, setDarkMode] = useState(false);
  const [results, setResults] = useState<AthleteResult[]>([]);
  const [loading, setLoading] = useState(true);
  const [currentPage, setCurrentPage] = useState<'dashboard' | 'results'>('dashboard');
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  // í•„í„° ìƒíƒœ
  const [selectedDiscipline, setSelectedDiscipline] = useState<string>('ì „ì²´');
  const [selectedGender, setSelectedGender] = useState<string>('ì „ì²´');
  const [searchTerm, setSearchTerm] = useState('');

  // ë‹¤í¬ëª¨ë“œ
  useEffect(() => {
    document.documentElement.classList.toggle('dark', darkMode);
  }, [darkMode]);

  // CSV ë¡œë”©
  useEffect(() => {
    fetch('/athletes-with-competitions.csv')
      .then(res => res.text())
      .then(csvText => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: (results) => {
            const cleanData = results.data.map((row: any) => {
              const cleanRow: any = {};
              Object.keys(row).forEach(key => {
                const cleanKey = key.replace(/^\uFEFF/, '').trim();
                cleanRow[cleanKey] = row[key];
              });
              return cleanRow;
            });
            setResults(cleanData as AthleteResult[]);
            setLoading(false);
          }
        });
      })
      .catch(err => {
        console.error('CSV ë¡œë”© ì—ëŸ¬:', err);
        setLoading(false);
      });
  }, []);

  // í•„í„°ë§ëœ ê²°ê³¼
  const filteredResults = useMemo(() => {
    return results.filter(r => {
      if (selectedDiscipline !== 'ì „ì²´' && !r.ì¢…ëª©.includes(selectedDiscipline)) return false;
      if (selectedGender !== 'ì „ì²´' && r.ì„±ë³„ !== selectedGender) return false;
      if (searchTerm) {
        const search = searchTerm.toLowerCase();
        return r.ì„ ìˆ˜ëª….toLowerCase().includes(search) || r.ì†Œì†.toLowerCase().includes(search);
      }
      return true;
    });
  }, [results, selectedDiscipline, selectedGender, searchTerm]);

  // í†µê³„ ê³„ì‚°
  const disciplines = ['ì „ì²´', 'AL', 'CC', 'JP', 'FS', 'SB'];

  const uniqueAthletes = useMemo(() =>
    Array.from(new Set(filteredResults.map(r => r.ì„ ìˆ˜ëª…))),
    [filteredResults]
  );

  const maleAthletes = useMemo(() =>
    new Set(filteredResults.filter(r => r.ì„±ë³„ === 'ë‚¨').map(r => r.ì„ ìˆ˜ëª…)).size,
    [filteredResults]
  );

  const femaleAthletes = useMemo(() =>
    new Set(filteredResults.filter(r => r.ì„±ë³„ === 'ì—¬').map(r => r.ì„ ìˆ˜ëª…)).size,
    [filteredResults]
  );

  const totalCompetitions = useMemo(() =>
    filteredResults.filter(r => r.ëŒ€íšŒëª…).length,
    [filteredResults]
  );

  const avgRanking = useMemo(() => {
    const rankings = filteredResults
      .filter(r => r.ë­í‚¹)
      .map(r => typeof r.ë­í‚¹ === 'string' ? parseInt(r.ë­í‚¹) : r.ë­í‚¹);
    return rankings.length > 0
      ? (rankings.reduce((a, b) => a + b, 0) / rankings.length).toFixed(1)
      : '0';
  }, [filteredResults]);

  // ì˜¬ë¦¼í”½ ìµœë‹¤ ì¶œì „ TOP 5 (ì „ì²´ ëˆ„ì )
  const topOlympicAthletes = useMemo(() => {
    const olympicCounts: Record<string, { count: number; athlete: AthleteResult }> = {};
    results
      .filter(r => r.ëŒ€íšŒì¹´í…Œê³ ë¦¬ === 'OG')
      .forEach(r => {
        if (!olympicCounts[r.ì„ ìˆ˜ëª…]) {
          olympicCounts[r.ì„ ìˆ˜ëª…] = { count: 0, athlete: r };
        }
        olympicCounts[r.ì„ ìˆ˜ëª…].count++;
      });

    return Object.entries(olympicCounts)
      .sort((a, b) => b[1].count - a[1].count)
      .slice(0, 5)
      .map(([name, data]) => ({
        ì„ ìˆ˜ëª…: name,
        ì¶œì „íšŸìˆ˜: data.count,
        ì¢…ëª©: data.athlete.ì¢…ëª©,
        FISí”„ë¡œí•„URL: data.athlete.FISí”„ë¡œí•„URL
      }));
  }, [results]);

  // ì›”ë“œì»µ ìµœë‹¤ ì¶œì „ TOP 5 (ì „ì²´ ëˆ„ì )
  const topWorldCupAthletes = useMemo(() => {
    const wcCounts: Record<string, { count: number; athlete: AthleteResult }> = {};
    results
      .filter(r => r.ëŒ€íšŒì¹´í…Œê³ ë¦¬ === 'WC')
      .forEach(r => {
        if (!wcCounts[r.ì„ ìˆ˜ëª…]) {
          wcCounts[r.ì„ ìˆ˜ëª…] = { count: 0, athlete: r };
        }
        wcCounts[r.ì„ ìˆ˜ëª…].count++;
      });

    return Object.entries(wcCounts)
      .sort((a, b) => b[1].count - a[1].count)
      .slice(0, 5)
      .map(([name, data]) => ({
        ì„ ìˆ˜ëª…: name,
        ì¶œì „íšŸìˆ˜: data.count,
        ì¢…ëª©: data.athlete.ì¢…ëª©,
        FISí”„ë¡œí•„URL: data.athlete.FISí”„ë¡œí•„URL
      }));
  }, [results]);

  // ì´ë²ˆ ì‹œì¦Œ ìµœê³  ì„±ì  TOP 5 (2025/26 ì‹œì¦Œ)
  const topSeasonPerformers = useMemo(() => {
    const seasonResults = results.filter(r => r.ì‹œì¦Œ === CURRENT_SEASON && r.ë­í‚¹);

    const bestResults: Record<string, { rank: number; athlete: AthleteResult }> = {};
    seasonResults.forEach(r => {
      const rank = typeof r.ë­í‚¹ === 'string' ? parseInt(r.ë­í‚¹) : r.ë­í‚¹;
      if (!bestResults[r.ì„ ìˆ˜ëª…] || rank < bestResults[r.ì„ ìˆ˜ëª…].rank) {
        bestResults[r.ì„ ìˆ˜ëª…] = { rank, athlete: r };
      }
    });

    return Object.entries(bestResults)
      .sort((a, b) => a[1].rank - b[1].rank)
      .slice(0, 5)
      .map(([name, data]) => ({
        ì„ ìˆ˜ëª…: name,
        ìµœê³ ìˆœìœ„: data.rank,
        ëŒ€íšŒëª…: data.athlete.ëŒ€íšŒëª…,
        ì¢…ëª©: data.athlete.ì¢…ëª©,
        ë‚ ì§œ: data.athlete.ë‚ ì§œ,
        FISí”„ë¡œí•„URL: data.athlete.FISí”„ë¡œí•„URL
      }));
  }, [results]);

  // ì›”ë“œì»µ ì¢…ëª©ë³„ ì°¸ê°€ ë¹„ìœ¨
  const wcDisciplineRatioOptions = useMemo(() => {
    const wcResults = results.filter(r => r.ëŒ€íšŒì¹´í…Œê³ ë¦¬ === 'WC');
    const disciplineCounts = wcResults.reduce((acc, r) => {
      acc[r.ì¢…ëª©] = (acc[r.ì¢…ëª©] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);

    return {
      chart: {
        type: 'pie',
        backgroundColor: 'transparent',
        style: { fontFamily: "'Inter', -apple-system, sans-serif" },
        height: 300
      },
      title: { text: null },
      tooltip: {
        pointFormat: '<b>{point.y}íšŒ</b> ({point.percentage:.1f}%)',
        backgroundColor: darkMode ? '#1F2937' : '#FFFFFF',
        borderColor: darkMode ? '#374151' : '#E5E7EB',
        style: { color: darkMode ? '#F9FAFB' : '#111827' }
      },
      plotOptions: {
        pie: {
          innerSize: '65%',
          dataLabels: {
            enabled: true,
            format: '{point.percentage:.0f}%',
            distance: -35,
            style: {
              color: '#FFFFFF',
              textOutline: 'none',
              fontSize: '13px',
              fontWeight: '700'
            }
          },
          showInLegend: true
        }
      },
      legend: {
        align: 'right',
        verticalAlign: 'middle',
        layout: 'vertical',
        itemStyle: {
          color: darkMode ? '#D1D5DB' : '#4B5563',
          fontWeight: '500',
          fontSize: '11px'
        }
      },
      series: [{
        name: 'ì¶œì „ íšŸìˆ˜',
        data: Object.entries(disciplineCounts).map(([name, count]) => ({
          name,
          y: count,
          color: getDisciplineColor(name)
        }))
      }],
      credits: { enabled: false }
    };
  }, [results, darkMode]);

  // ì›”ë“œì»µ ë“±ìˆ˜ ë¶„í¬
  const wcRankingDistOptions = useMemo(() => {
    const wcResults = results.filter(r => r.ëŒ€íšŒì¹´í…Œê³ ë¦¬ === 'WC' && r.ë­í‚¹);
    const rankings = wcResults.map(r => typeof r.ë­í‚¹ === 'string' ? parseInt(r.ë­í‚¹) : r.ë­í‚¹);

    const distribution = {
      '1ìœ„': rankings.filter(r => r === 1).length,
      '2-3ìœ„': rankings.filter(r => r >= 2 && r <= 3).length,
      '4-5ìœ„': rankings.filter(r => r >= 4 && r <= 5).length,
      '6-10ìœ„': rankings.filter(r => r >= 6 && r <= 10).length,
      '11-20ìœ„': rankings.filter(r => r >= 11 && r <= 20).length,
      '21ìœ„ ì´í•˜': rankings.filter(r => r >= 21).length
    };

    return {
      chart: {
        type: 'column',
        backgroundColor: 'transparent',
        style: { fontFamily: "'Inter', -apple-system, sans-serif" },
        height: 280
      },
      title: { text: null },
      xAxis: {
        categories: Object.keys(distribution),
        labels: {
          style: {
            color: darkMode ? '#9CA3AF' : '#6B7280',
            fontSize: '11px',
            whiteSpace: 'nowrap'
          },
          rotation: 0
        },
        lineColor: darkMode ? '#374151' : '#E5E7EB'
      },
      yAxis: {
        title: { text: null },
        labels: { style: { color: darkMode ? '#9CA3AF' : '#6B7280' } },
        gridLineColor: darkMode ? '#374151' : '#E5E7EB'
      },
      plotOptions: {
        column: {
          borderRadius: 6,
          dataLabels: {
            enabled: true,
            style: { color: darkMode ? '#FFF' : '#000', textOutline: 'none', fontWeight: '700' }
          },
          colorByPoint: true,
          colors: ['#F59E0B', '#10B981', '#3B82F6', '#8B5CF6', '#EC4899', '#6B7280']
        }
      },
      series: [{
        name: 'ëŒ€íšŒ ìˆ˜',
        data: Object.values(distribution)
      }],
      legend: { enabled: false },
      credits: { enabled: false }
    };
  }, [results, darkMode]);

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600 dark:text-gray-400 text-sm">ë°ì´í„° ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-950 transition-colors">
      {/* Header with Top Navigation */}
      <header className="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50">
        <div className="w-full px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="w-10 h-10 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg">
                <span className="text-white font-black text-base">KSA</span>
              </div>
              <div className="hidden sm:block">
                <h1 className="text-xl lg:text-2xl font-bold text-gray-900 dark:text-white whitespace-nowrap">
                  TEAM KOREA SKI & SNOWBOARD
                </h1>
                <p className="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap">êµ­ê°€ëŒ€í‘œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</p>
              </div>
            </div>

            {/* Desktop Navigation */}
            <div className="hidden md:flex items-center space-x-3">
              <button
                onClick={() => setCurrentPage('dashboard')}
                className={`flex items-center space-x-2 px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap ${
                  currentPage === 'dashboard'
                    ? 'text-blue-600 bg-blue-50 dark:bg-blue-900/20'
                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'
                }`}
              >
                <Activity size={18} />
                <span>Dashboard</span>
              </button>
              <button
                onClick={() => setCurrentPage('results')}
                className={`flex items-center space-x-2 px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap ${
                  currentPage === 'results'
                    ? 'text-blue-600 bg-blue-50 dark:bg-blue-900/20'
                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'
                }`}
              >
                <Users size={18} />
                <span>ìµœê·¼ ëŒ€íšŒ ì„±ì </span>
              </button>
              <button
                onClick={() => setDarkMode(!darkMode)}
                className="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              >
                {darkMode ? <Sun size={20} /> : <Moon size={20} />}
              </button>
            </div>

            {/* Mobile Menu Button */}
            <div className="md:hidden flex items-center space-x-2">
              <button
                onClick={() => setDarkMode(!darkMode)}
                className="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"
              >
                {darkMode ? <Sun size={18} /> : <Moon size={18} />}
              </button>
              <button
                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                className="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"
              >
                <Menu size={18} />
              </button>
            </div>
          </div>

          {/* Mobile Navigation Dropdown */}
          {mobileMenuOpen && (
            <div className="md:hidden mt-4 pt-4 border-t border-gray-200 dark:border-gray-800">
              <div className="space-y-2">
                <button
                  onClick={() => {
                    setCurrentPage('dashboard');
                    setMobileMenuOpen(false);
                  }}
                  className={`w-full flex items-center space-x-2 px-4 py-2 text-sm font-medium rounded-lg ${
                    currentPage === 'dashboard'
                      ? 'text-blue-600 bg-blue-50 dark:bg-blue-900/20'
                      : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'
                  }`}
                >
                  <Activity size={18} />
                  <span>Dashboard</span>
                </button>
                <button
                  onClick={() => {
                    setCurrentPage('results');
                    setMobileMenuOpen(false);
                  }}
                  className={`w-full flex items-center space-x-2 px-4 py-2 text-sm font-medium rounded-lg ${
                    currentPage === 'results'
                      ? 'text-blue-600 bg-blue-50 dark:bg-blue-900/20'
                      : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'
                  }`}
                >
                  <Users size={18} />
                  <span>ìµœê·¼ ëŒ€íšŒ ì„±ì </span>
                </button>
              </div>
            </div>
          )}
        </div>
      </header>

      {/* Main Content - Full Width */}
      <main className="w-full px-4 sm:px-6 lg:px-8 py-6">
        {currentPage === 'dashboard' ? (
          <>
            {/* TOP 5 Rankings Section */}
            <div className="mb-8">
              <h2 className="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <Star className="mr-2 text-yellow-500" size={24} />
                <span className="whitespace-nowrap">TOP 5 Rankings</span>
                <span className="ml-3 text-xs font-normal text-gray-500 dark:text-gray-400 whitespace-nowrap">
                  ({CURRENT_SEASON} ì‹œì¦Œ ê¸°ì¤€ / ì˜¬ë¦¼í”½Â·ì›”ë“œì»µì€ ì „ì²´ ëˆ„ì )
                </span>
              </h2>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* ì˜¬ë¦¼í”½ ìµœë‹¤ ì¶œì „ (ì „ì²´ ëˆ„ì ) */}
                <div className="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl p-6 border border-yellow-200 dark:border-yellow-800">
                  <div className="flex items-center mb-4">
                    <Medal className="text-yellow-600 dark:text-yellow-400 mr-2" size={20} />
                    <h3 className="text-sm font-bold text-gray-900 dark:text-white whitespace-nowrap">ì˜¬ë¦¼í”½ ìµœë‹¤ ì¶œì „ (ì „ì²´ ëˆ„ì )</h3>
                  </div>
                  <div className="space-y-3">
                    {topOlympicAthletes.map((athlete, idx) => (
                      <div key={idx} className="flex items-center justify-between bg-white/60 dark:bg-gray-800/60 rounded-lg p-3">
                        <div className="flex items-center space-x-3">
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                            idx === 0 ? 'bg-yellow-500 text-white' :
                            idx === 1 ? 'bg-gray-400 text-white' :
                            idx === 2 ? 'bg-amber-600 text-white' :
                            'bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                          }`}>
                            {idx + 1}
                          </div>
                          <div className="min-w-0">
                            {athlete.FISí”„ë¡œí•„URL ? (
                              <a
                                href={athlete.FISí”„ë¡œí•„URL}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="font-semibold text-blue-600 dark:text-blue-400 hover:underline text-sm whitespace-nowrap"
                              >
                                {athlete.ì„ ìˆ˜ëª…}
                              </a>
                            ) : (
                              <span className="font-semibold text-gray-900 dark:text-white text-sm whitespace-nowrap">{athlete.ì„ ìˆ˜ëª…}</span>
                            )}
                            <p className="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap">{athlete.ì¢…ëª©}</p>
                          </div>
                        </div>
                        <span className="font-bold text-yellow-600 dark:text-yellow-400 text-sm whitespace-nowrap">{athlete.ì¶œì „íšŸìˆ˜}íšŒ</span>
                      </div>
                    ))}
                    {topOlympicAthletes.length === 0 && (
                      <p className="text-xs text-gray-500 dark:text-gray-400 text-center py-4">ì¶œì „ ê¸°ë¡ ì—†ìŒ</p>
                    )}
                  </div>
                </div>

                {/* ì›”ë“œì»µ ìµœë‹¤ ì¶œì „ (ì „ì²´ ëˆ„ì ) */}
                <div className="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border border-blue-200 dark:border-blue-800">
                  <div className="flex items-center mb-4">
                    <Trophy className="text-blue-600 dark:text-blue-400 mr-2" size={20} />
                    <h3 className="text-sm font-bold text-gray-900 dark:text-white whitespace-nowrap">ì›”ë“œì»µ ìµœë‹¤ ì¶œì „ (ì „ì²´ ëˆ„ì )</h3>
                  </div>
                  <div className="space-y-3">
                    {topWorldCupAthletes.map((athlete, idx) => (
                      <div key={idx} className="flex items-center justify-between bg-white/60 dark:bg-gray-800/60 rounded-lg p-3">
                        <div className="flex items-center space-x-3">
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                            idx === 0 ? 'bg-blue-500 text-white' :
                            idx === 1 ? 'bg-blue-400 text-white' :
                            idx === 2 ? 'bg-blue-300 text-white' :
                            'bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                          }`}>
                            {idx + 1}
                          </div>
                          <div className="min-w-0">
                            {athlete.FISí”„ë¡œí•„URL ? (
                              <a
                                href={athlete.FISí”„ë¡œí•„URL}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="font-semibold text-blue-600 dark:text-blue-400 hover:underline text-sm whitespace-nowrap"
                              >
                                {athlete.ì„ ìˆ˜ëª…}
                              </a>
                            ) : (
                              <span className="font-semibold text-gray-900 dark:text-white text-sm whitespace-nowrap">{athlete.ì„ ìˆ˜ëª…}</span>
                            )}
                            <p className="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap">{athlete.ì¢…ëª©}</p>
                          </div>
                        </div>
                        <span className="font-bold text-blue-600 dark:text-blue-400 text-sm whitespace-nowrap">{athlete.ì¶œì „íšŸìˆ˜}íšŒ</span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* ì´ë²ˆ ì‹œì¦Œ ìµœê³  ì„±ì  (2025/26) */}
                <div className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border border-green-200 dark:border-green-800">
                  <div className="flex items-center mb-4">
                    <Zap className="text-green-600 dark:text-green-400 mr-2" size={20} />
                    <h3 className="text-sm font-bold text-gray-900 dark:text-white whitespace-nowrap">ì´ë²ˆ ì‹œì¦Œ ìµœê³  ì„±ì  ({CURRENT_SEASON})</h3>
                  </div>
                  <div className="space-y-3">
                    {topSeasonPerformers.map((athlete, idx) => (
                      <div key={idx} className="flex items-center justify-between bg-white/60 dark:bg-gray-800/60 rounded-lg p-3">
                        <div className="flex items-center space-x-3">
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                            athlete.ìµœê³ ìˆœìœ„ === 1 ? 'bg-green-500 text-white' :
                            athlete.ìµœê³ ìˆœìœ„ <= 3 ? 'bg-green-400 text-white' :
                            athlete.ìµœê³ ìˆœìœ„ <= 5 ? 'bg-green-300 text-white' :
                            'bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                          }`}>
                            {athlete.ìµœê³ ìˆœìœ„}
                          </div>
                          <div className="min-w-0">
                            {athlete.FISí”„ë¡œí•„URL ? (
                              <a
                                href={athlete.FISí”„ë¡œí•„URL}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="font-semibold text-blue-600 dark:text-blue-400 hover:underline text-sm whitespace-nowrap"
                              >
                                {athlete.ì„ ìˆ˜ëª…}
                              </a>
                            ) : (
                              <span className="font-semibold text-gray-900 dark:text-white text-sm whitespace-nowrap">{athlete.ì„ ìˆ˜ëª…}</span>
                            )}
                            <p className="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap">{athlete.ì¢…ëª©}</p>
                          </div>
                        </div>
                        <div className="text-right">
                          <p className="font-bold text-green-600 dark:text-green-400 text-xs whitespace-nowrap">{athlete.ìµœê³ ìˆœìœ„}ìœ„</p>
                          <p className="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap">{athlete.ë‚ ì§œ?.substring(5)}</p>
                        </div>
                      </div>
                    ))}
                    {topSeasonPerformers.length === 0 && (
                      <p className="text-xs text-gray-500 dark:text-gray-400 text-center py-4">ì´ë²ˆ ì‹œì¦Œ ê¸°ë¡ ì—†ìŒ</p>
                    )}
                  </div>
                </div>
              </div>
            </div>

            {/* ì›”ë“œì»µ ë¶„ì„ ì„¹ì…˜ */}
            <div className="mb-8">
              <h2 className="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <Trophy className="mr-2 text-blue-600" size={24} />
                <span className="whitespace-nowrap">ì›”ë“œì»µ ë¶„ì„</span>
              </h2>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className="bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800">
                  <h3 className="text-sm font-semibold text-gray-900 dark:text-white mb-4 whitespace-nowrap">ì¢…ëª©ë³„ ì°¸ê°€ ë¹„ìœ¨</h3>
                  <HighchartsReact highcharts={Highcharts} options={wcDisciplineRatioOptions} />
                </div>

                <div className="bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800">
                  <h3 className="text-sm font-semibold text-gray-900 dark:text-white mb-4 whitespace-nowrap">ë“±ìˆ˜ ë¶„í¬</h3>
                  <HighchartsReact highcharts={Highcharts} options={wcRankingDistOptions} />
                </div>
              </div>
            </div>
          </>
        ) : (
          /* ìµœê·¼ ëŒ€íšŒ ì„±ì  í˜ì´ì§€ */
          <div className="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div className="p-6 border-b border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white whitespace-nowrap">ğŸ“Š ëŒ€íšŒ ë° ê²½ê¸° ê²°ê³¼</h3>
              <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
                <span className="whitespace-nowrap">ê¸°ê°„: {SEASON_START} ~ {SEASON_END}</span>
                <span className="mx-2">|</span>
                <span className="whitespace-nowrap">ì„ ìˆ˜ ì´ë¦„ì„ í´ë¦­í•˜ë©´ FIS í”„ë¡œí•„ë¡œ ì´ë™í•©ë‹ˆë‹¤</span>
              </p>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-800">
                  <tr>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ë‚ ì§œ</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ì´ë¦„</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ì„±ë³„</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ì¢…ëª©</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ëŒ€íšŒëª…</th>
                    <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ì¹´í…Œê³ ë¦¬</th>
                    <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">ìˆœìœ„</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200 dark:divide-gray-800">
                  {filteredResults
                    .filter(r => r.ëŒ€íšŒëª…)
                    .sort((a, b) => new Date(b.ë‚ ì§œ).getTime() - new Date(a.ë‚ ì§œ).getTime())
                    .map((r, i) => (
                      <tr key={i} className="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                        <td className="px-4 py-4 text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap">{r.ë‚ ì§œ}</td>
                        <td className="px-4 py-4 text-sm">
                          {r.FISí”„ë¡œí•„URL ? (
                            <a
                              href={r.FISí”„ë¡œí•„URL}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="font-semibold text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center whitespace-nowrap"
                            >
                              {r.ì„ ìˆ˜ëª…}
                              <svg className="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                              </svg>
                            </a>
                          ) : (
                            <span className="font-semibold text-gray-900 dark:text-white whitespace-nowrap">{r.ì„ ìˆ˜ëª…}</span>
                          )}
                        </td>
                        <td className="px-4 py-4 text-sm">
                          <span className={`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${
                            r.ì„±ë³„ === 'ë‚¨'
                              ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300'
                              : 'bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300'
                          }`}>
                            {r.ì„±ë³„}
                          </span>
                        </td>
                        <td className="px-4 py-4 text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap">{r.ì¢…ëª©}</td>
                        <td className="px-4 py-4 text-sm text-gray-600 dark:text-gray-300">
                          <div className="max-w-xs truncate" title={r.ëŒ€íšŒëª…}>
                            {r.ëŒ€íšŒëª…}
                          </div>
                        </td>
                        <td className="px-4 py-4 text-center">
                          <span
                            className="px-2 py-1 rounded text-xs font-bold text-white whitespace-nowrap"
                            style={{ backgroundColor: getCategoryColor(r.ëŒ€íšŒì¹´í…Œê³ ë¦¬) }}
                          >
                            {r.ëŒ€íšŒì¹´í…Œê³ ë¦¬}
                          </span>
                        </td>
                        <td className="px-4 py-4 text-sm text-right">
                          <span className={`font-bold whitespace-nowrap ${
                            typeof r.ë­í‚¹ === 'number' && r.ë­í‚¹ === 1 ? 'text-yellow-600 dark:text-yellow-400' :
                            typeof r.ë­í‚¹ === 'number' && r.ë­í‚¹ <= 3 ? 'text-green-600 dark:text-green-400' :
                            typeof r.ë­í‚¹ === 'number' && r.ë­í‚¹ <= 10 ? 'text-blue-600 dark:text-blue-400' :
                            'text-gray-900 dark:text-white'
                          }`}>
                            {r.ë­í‚¹}ìœ„
                          </span>
                        </td>
                      </tr>
                    ))}
                </tbody>
              </table>
            </div>
            <div className="p-4 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-800">
              <p className="text-xs text-gray-500 dark:text-gray-400">
                <span className="whitespace-nowrap">ì´ <span className="font-semibold text-blue-600 dark:text-blue-400">{filteredResults.filter(r => r.ëŒ€íšŒëª…).length}ê°œ</span>ì˜ ëŒ€íšŒ ì„±ì </span>
              </p>
            </div>
          </div>
        )}
      </main>
    </div>
  );
}

function getCategoryColor(category: string): string {
  const colors: Record<string, string> = {
    'OG': '#F59E0B',
    'WCH': '#8B5CF6',
    'WC': '#3B82F6',
    'EC': '#10B981',
    'FIS': '#6B7280'
  };
  return colors[category] || '#6B7280';
}

function getDisciplineColor(discipline: string): string {
  const colors: Record<string, string> = {
    'AL': '#EF4444',
    'CC': '#10B981',
    'JP': '#F59E0B',
    'FS': '#8B5CF6',
    'FS SS': '#A855F7',
    'FS MO': '#7C3AED',
    'SB': '#3B82F6',
    'SB AL': '#2563EB',
    'SB SBX': '#0EA5E9',
    'SB HP': '#06B6D4',
    'SB BA': '#14B8A6'
  };

  // ë¨¼ì € ì •í™•í•œ ë§¤ì¹­ ì‹œë„
  if (colors[discipline]) {
    return colors[discipline];
  }

  // ë¶€ë¶„ ë§¤ì¹­ ì‹œë„
  for (const [key, color] of Object.entries(colors)) {
    if (discipline.includes(key)) {
      return color;
    }
  }

  return '#6B7280';
}

export default App;
